#!/bin/bash

dist_path="out"
build_hash="$dist_path/hash"

echo "ğŸ‘· Build Static site..."

echo "ğŸ¤– Run next build..."
if ! next build; then
  echo "ğŸ‘¹ Oops! Nextjs build failed"
  exit 1
fi

echo "ğŸ¤– Generate sitemap..."
if ! pnpm run generate:sitemap; then
  echo "ğŸ‘¹ Oops! Sitemap generator failure"
  exit 1
fi

echo "ğŸ¤– Copy public assets to $dist_path"
if ! cp -r public/* "$dist_path"; then
  echo "ğŸ‘¹Oops! Failed to copy public assets to distribution directory"
  exit 1
fi

.scripts/test_run_hash_signature > "$build_hash"

echo
echo "ğŸ‘ Static site builder completed!"
