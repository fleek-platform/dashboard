#!/bin/bash

SHORT_HASH=$(git rev-parse --short HEAD)

VERSION=$(jq -r .version package.json)

if [[ "$VERSION" =~ -rc.* ]]; then
  echo "ğŸ‘¹ Oops! The package is already versioned with -rc e.g. $VERSION"

  exit 1
fi

if ! jq --arg hash "$SHORT_HASH" \
  '.version = .version + "-rc." + $hash' \
  package.json > temp.json; then
  echo "ğŸ‘¹ Oops! Failed to set the rc version for some reason..."

  exit 1
fi
  
mv temp.json package.json

echo "ğŸ‘ Done! Updated to version $(jq -r .version package.json)"
